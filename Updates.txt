4.0.0 - b4015
——————————————
Changed
- The database now logs all dates/times as Unix timestamps rather than .Net DateTime.Ticks
- This means consistent handling of DST change, and Unix timestamps are supported by all major languages
- YOU MUST DELETE your existing cumulusmx-v4.db file before running b4015
- The "load files to database" function that runs when CMXv4 is launched:
	- Has been updated and now understands the swap from DST to standard time when an hours data is repeated in the log files.
	- It also now loads all the extra sensor data to the database (previously just the dayfile and monthly log files were loaded). This is pretty untested as
	  I do not have historic files with any data in them, and I only tested a tiny bit of manually created data.
- The v4 dayfile has an added field of Unix Timestamp, I have added this as the second field, this will break any existing dayfile parsers. I could add it at the end but that offends my sense of order!

- The MigrateData3to4 utility has been updated. This now also understands (I hope!) the swap from DST to standard time when an hours data is repeated in the v3 log files.
	- If this is robust, then I will look to add this to v3 as well



4.0.0 - b4014
——————————————
Fixed
- Decryption error on blank APRS password
- Consistent graph hours across DST changes
- Line numbering error in DailyData viewer across pages
- Various potential issues with data timestamps across DST changes


Changed
- Adds wind run to the dashboard Now page
- FTP logging reworked
	- Now logs to the file ftp.log in the MXdiags folder
	- Log file size is limited to 5 MB, but on rollover 3 archives are kept
	- The logging level (verbosity) can now be set in Program Settings
	- The source (real-time, interval, CMX) is now logged to aid decoding


4.0.0 - b4013
——————————————
Incorporates v3 changes up to b3214

Fixed
- Ecowitt Local API going into an infinite loop on bad response from device
- Incorrect SSH.Net library



4.0.0 - b4012
——————————————
Incorporates v3 changes up to b3191

Fixed
- Potential issue whereby Ecowitt historic data download could get stuck in a loop downloading the same block
- NOAA report generation
- SolarRad web tag, when no solar data available

Changed
- The "live" dashboard screens now refresh whenever new data is received, or every five seconds
- Removed database compression on every start-up

New
- Display passwords option in Program Settings | General Options. When disabled (default), all passwords are sent to the settings pages as "*****". You can still enter new passwords whilst in this mode.


4.0.0 - b4010
——————————————
- More nullification
- Fix: CPU temp check on Linux?
- Fix: Start-up PING is now run in a separate thread so if it hangs CMX can continue


4.0.0 - b4009
——————————————
- Fix Ecowitt historic catch-up crash processing Soil Moisture sensor data
- Now catches the crash in loading the Moon image
- Attempt at fixing the cause of the crash loading Moon image - set a defined max memory pool size


4.0.0 - b4008
——————————————
- Adds new Data Logging Settings page to control logging of extra sensors to the database, and the creation of the legacy v3 log files.
- Fixes nullable value Exception when processing temperature values (it was the dewpoint causing the problem)
- Change Linux service installer to add the line "Wants=network-online.target" to the service file
- Fix crash on start-up getting the local IP address if the network is not ready
- Fix Ecowitt API settings not being loaded into Station Settings page
- Fix GW1000 station not attempting to reconnect on connection failure


4.0.0 - b4007
——————————————
- All the v3.15.0 updates applied (Ecowitt API code refactored)
- Virtually all the primary data and extra sensor values are now nullable
- The Cumulus.ini file parser now understands "null" as a value, so you will see xxx=null in the today/yesterday.ini etc files where values have not yet been determined
- HTTP (Ecowitt) - now has the option to configure the Custom Server settings for you.
	- It also has the ability to change the update time down to as low as 5 seconds
	- Note Times below 16 secs are incompatible with the WS View apps - if you alter another server setting in the Apps they will complain that the custom server value is invalid and you will have to reset it back 16 seconds. But CMX will reconfigure it back to 5 seconds on the next restart
- Two new logging options - Raw Data Log for both main station and extra sensors. This logs just the transmit/receive data to/from the station into separate log files (not all stations supported, I have not implemented on WMR stations for instance)


4.0.0 - b4006
——————————————
- Converted to .Net 6
- Extra data logging now moved to the database as the primary source. It now also supports null values
	- Currently there is no pre-loading of the extra data tables from the extra logfiles
- Interval data and extra data editors switched back to server side processing. There are no longer any restrictions on the date ranges
- No longer requires the libgdiplus library on Linux/MacOS
- The Moon image has a new option, the "shadow" can be either the image dimmed by 80% as before, or now can be made transparent
- Improved Ecowitt GW1000 auto-discovery mechanism
- The Solar calculation now allows you to input different transparency values for July and August. MX uses a cosine interpolation between the two values
- The data folder has been renamed to /datav4 for this release
- The MigrateData3to4 utility now reads from the /data folder and writes to the /datav4 folder

- There are new options to control extra data logging to the database by type rather than the current global switch.
	- There is no GUI for setting these yet. Please add the following section to your Cumulus.ini file to control this...
	[ExtraDataLogging]
	Temperature=1
	Humidity=1
	Dewpoint=1
	UserTemp=1
	SoilTemp=1
	SoilMoisture=1
	LeafTemp=1
	LeafWetness=1
	AirQual=1
	CO2=1

- The database table for AQ values is temporary whilst I decide the best way of storing this information across different sensor types



4.0.0 - b4005
——————————————
- Final versions of the records editors. These now "look" better in that all default values of 999 etc are all replaced with a dash.
	- I'll port much of this code back into CMX v3
- The logged data editors (apart from Extra) are now rewritten using the database. The interval data has been changed completely from server side processing to client side. That
	means the data is loaded into your browser for paging rather than being fetched a page a time so it may load a little slower than before.
	- But the single day restriction has gone. You can now select a range of days. Note you will be limited to the first 5000 records from that range for performance reasons.
	- It also implements Search - so you can enter a (rouge?) value and it will only show those rows within your date range that contain that value.
		Note the search is a dumb text compare, but you can also search time stamps.


4.0.0 - b4004
——————————————
- Reverts the daily data SQLite table name to DayData
- Adds new Table LogData
- All your monthly log files should be imported into the new SQLite database on first run
- All internal functions (I think!) that use the dayfile or logfile data, now use the SQLite database rather than the text files as their data sources. ExtraLogFiles not done yet
- Incorporates all the latest fixes in the v3 release
- Additional logging for wind data on the GW1000 station



4.0.0 - b4003
——————————————
- Fix: GW1000 station not working correctly
- Fix: HTTP Ecowitt stations not decoding user temp sensors (extra did)
- Fix: Graph data files now display correct date/time in HighCharts - I HOPE!
- Fix: Option to edit MySQL is disabled if no MySQL log on details are provided

- New: Password and secret fields in the settings now reveal the password when they have focus

- NEW/CHANGE: BIG FIRST STEP in using an internal database
	- This build now uses the SQLite database for the daily data. It still generates the dayfile, but it now never reads it again other than to load it into the database on first run
	- The database and MX functions around it now support null values - hurrah! A baby step to general support of null values.
	- You will see this in the dayfile editor, null values will show as blank fields. You can try deleting a value in edit.
	- For now the first 15 fields or so are not nullable. In the next build I hope to make all dayfile data nullable.
	- The dayfile editor (to be renamed) actually edits the database as the prime source (though it still also updates the dayfile and optionally MySQL as well)
	- TODOs:
		1. I think we probably need a function to clear the database table and re-import the dayfile (though deleting the whole database does this)
		2. An export to dayfile function - if we eventually make the log files optional
	- I'll be interested to see if anyone has issues with the performance of the database compared with the previous file + in-memory data list.
		I expect it to be slightly slower, but hopefully not dramatically so.

- Change: dayfile name changed to dayfile-v4.txt
- Change: SQLite database name changed to cumulusmx-v4.db
- Change: The backup folders now have a /data sub folder to separate the config files and the data files
- Change: SQLite database cumulusmx-v4.db will now additional runtime files associated with it (-shm and -wal) these are for additional resilience and should be removed
	on a clean shutdown of MX. If they remain it means the shutdown was not clean and will be used to recover the database if required on next start-up
- Change: Various library updates - I intend to stay on latest versions all the time during testing
	- MQTTnet
	- SQLitePCLRaw



4.0.0 - b4002
——————————————
- Fix: HTTP stations no longer require the /api/ URL prefix


4.0.0 - b4001
——————————————
- Fix: Diary database, the previous diary.db file will now have messed up entries in it if you edited the diary with b4000.
	Either delete the file before starting MX, or re-copy your existing one from MV v3.
	(The cause was SQLite library reversing the default value of a optional switch about date storage)
- Fix: Backups now name the backed up day file dayfile2.txt rather than dayfile.txt
- Fix: NOAA Monthly report was broken reading the log file
- Fix: Duplicate day file entries when the station is not responding on start-up

- Fix/New: The install as a service should now work again for Windows. It *may" now also work on Linux!


- New: Now encrypts user credentials in the cumulus.ini file
	- This isn't meant to be a terribly secure solution, it is prevent users posting a cumulus.ini file that contains plaintext creds as diagnostics on the forum.
	- A UniqueId.txt file is created in the main CumulusMX folder, this contains the decrypt key for the credentials. Anyone with access to this file can decrypt
		the credentials in cumulus.ini


- Changed: Exception logging is now standardised and much more verbose. Hopefully it will provide more meaningful diagnostics for failures
- Changed: Internal changes, lots more code now running asynchronously including SQLite, some structural changes


4.0.0 - b4000
——————————————

- Installing .Net 5 on Windows (if not already installed)
	- Go to the download page https://dotnet.microsoft.com/download/dotnet
	- Download the .NET 5.0 Runtime package for Windows (x64 most likely!)
	- Run the downloaded file



- Installing .Net 5 on Raspberry Pi - This assumes you are running Debian/Raspbian 11
	- A utility to check how many bits your processor uses...
		sudo apt update
		sudo apt install lshw
		sudo lshw | grep width
	- Check the output, is the "width" 64 or 32 bits? You will need to know this for the install

	See this web page for Microsoft's instructions https://docs.microsoft.com/en-gb/dotnet/core/install/linux-debian

	- Install the Runtime on 64 bit Pi's (Pi 4 only)
		- Before you install .NET, run the following commands to add the Microsoft package signing key to your list of trusted keys and add the package repository.
			wget https://packages.microsoft.com/config/debian/11/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
			sudo dpkg -i packages-microsoft-prod.deb
			rm packages-microsoft-prod.deb
		- Now do the install
			sudo apt-get update; \
			  sudo apt-get install -y apt-transport-https && \
			  sudo apt-get update && \
			  sudo apt-get install -y dotnet-runtime-5.0

	- Install the Runtime on 32 bit Pi's (everything other than the Pi 4)
		wget https://dot.net/v1/dotnet-install.sh
		chmod +x dotnet-install.sh
		sudo ./dotnet-install.sh -c Current --install-dir /usr/share/dotnet --runtime dotnet
		sudo echo 'export PATH=$PATH:/usr/share/dotnet' > /etc/profile.d/dotnet.sh
		sudo chmod +x /etc/profile.d/dotnet.sh
		export PATH=$PATH:/usr/share/dotnet

	- Test the run time
		dotnet --info

	- Copy the contents of the distribution zip file to /opt/CumulusMX



- Running Cumulus MX 4 on Windows
	cd /CumulusMX
	CumulusMX.exe

- Running Cumulus MX 4 on Linux
	cd /opt/CumulusMX
	dotnet CumulusMX.dll
